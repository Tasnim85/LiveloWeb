<!DOCTYPE html>

<!-- =========================================================
* Sneat - Bootstrap 5 HTML Admin Template - Pro | v1.0.0
==============================================================

* Product Page: https://themeselection.com/products/sneat-bootstrap-html-admin-template/
* Created by: ThemeSelection
* License: You must have a valid license purchased in order to legally use the theme for your project.
* Copyright ThemeSelection (https://themeselection.com)

=========================================================
 -->
<!-- beautify ignore:start -->
<html
  lang="en"
  class="light-style layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="../assets/"
  data-template="vertical-menu-template-free"

  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>Admin Orders</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="{{ asset ('bo/assets/vendor/fonts/boxicons.css')}}" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="{{ asset ('bo/assets/vendor/css/core.css')}}" class="template-customizer-core-css"/> 
    <link rel="stylesheet" href="{{ asset ('bo/assets/vendor/css/theme-default.css')}}" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="{{ asset ('bo/assets/css/demo.css')}}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="{{ asset ('bo/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css')}}" />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="{{ asset ('bo/assets/vendor/js/helpers.js')}}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="{{ asset ('bo/assets/js/config.js')}}"></script>
    <script>
  document.addEventListener('DOMContentLoaded', () => {
    const userJson = localStorage.getItem('user_data');
    if (userJson) {
      const user = JSON.parse(userJson);
      console.log('üë§ Restored User Data:', user);
    } else {
      console.log('‚ö†Ô∏è No user_data in localStorage');
    }
  });
</script>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
        <a href="{{ path('app_homeAdmin') }}">
           <div class="app-brand justify-content-center">
                  <img src="{{ asset('bo/logo_final-removebg-preview.png') }}" alt="Logo" style="max-width: 150px;">
            </div>
        </a>
          <div class="menu-inner-shadow"></div>

          <ul class="menu-inner py-1">
            

            <!-- Layouts -->
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                  <img src="{{ asset('bo/assets/img/icons/user(1).png') }}" width="28" height="28" />
                <div data-i18n="Layouts">Users</div>
              </a>

              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="{{ path('app_not_verified_users') }}" class="menu-link">
                    <div data-i18n="Without menu">Pending users</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="{{ path('app_list_users') }}" class="menu-link">
                    <div data-i18n="Without navbar">All users</div>
                  </a>
                </li>
              </ul>
            </li>
            
            <li class="menu-item">
              <a
                href="https://themeselection.com/demo/sneat-bootstrap-html-admin-template/documentation/"
                target="_blank"
                class="menu-link"
              >
                  <img src="{{ asset('bo/assets/img/icons/menu.png') }}" width="28" height="28" />
                <div data-i18n="Documentation">Categories</div>
              </a>
            </li>
            <li class="menu-item">
              <a
                href="https://themeselection.com/demo/sneat-bootstrap-html-admin-template/documentation/"
                target="_blank"
                class="menu-link"
              >
                  <img src="{{ asset('bo/assets/img/icons/radar.png') }}" width="28" height="28" />
                <div data-i18n="Documentation">Coverage areas</div>
              </a>
            </li>
            <li class="menu-item">
              <a
                href="https://github.com/themeselection/sneat-html-admin-template-free/issues"
                target="_blank"
                class="menu-link"
              >
                  <img src="{{ asset('bo/assets/img/icons/helmet-removebg-preview.png') }}" width="28" height="28" /><p>  </p>
                <div data-i18n="Support">Riders performance</div>
              </a>
            </li>
              
           <!-- Orders Report -->
<li class="menu-item">
  <a href="javascript:void(0);" class="menu-link menu-toggle">
    <i>
      <img src="{{ asset('bo/assets/img/icons/shopping-cart.png') }}" width="28" height="28" />
    </i>
    <div data-i18n="Orders">Orders Report</div>
  </a>

  <ul class="menu-sub">
    <li class="menu-item">
      <a href="{{ path('admin_stats') }}" class="menu-link">
        <div data-i18n="Stats">Statistics</div>
      </a>
    </li>
    <li class="menu-item">
      <a href="{{ path('app_admin_commande') }}" class="menu-link">
        <div data-i18n="Listing">Orders Listing</div>
      </a>
    </li>
  </ul>
</li>

          </ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

           <nav
            class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
            id="layout-navbar"
          > 
            <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
              <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                <i class="bx bx-menu bx-sm"></i>
              </a>
            </div>

            <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
              <!-- Search -->
<div class="navbar-nav align-items-center">
    <div class="nav-item d-flex align-items-center">
        <i class="bx bx-search fs-4 lh-0"></i>
        <input
            type="text"
            id="searchInput"
            class="form-control border-0 shadow-none"
            placeholder="Search..."
            aria-label="Search..."
        />
    </div>
</div>
<!-- /Search -->

             <ul class="navbar-nav flex-row align-items-center ms-auto">
                <!-- Place this tag where you want the button to render. -->
                <li class="nav-item lh-1 me-3">
                  <a
                    class="github-button"
                    href="https://github.com/themeselection/sneat-html-admin-template-free"
                    data-icon="octicon-star"
                    data-size="large"
                    data-show-count="true"
                    aria-label="Star themeselection/sneat-html-admin-template-free on GitHub"
                    >Star</a
                  >
                </li>

                <!-- User -->
                <li class="nav-item navbar-dropdown dropdown-user dropdown">
                  <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                    <div class="avatar avatar-online">
                      <img src="{{ asset('bo/assets/img/avatars/1.png') }}" alt class="w-px-40 h-auto rounded-circle" />
                    </div>

                  </a>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                      <a class="dropdown-item" href="#">
                        <div class="d-flex">
                          <div class="flex-shrink-0 me-3">
                            <div class="avatar avatar-online">
                              <img src="{{ asset('bo/assets/img/avatars/1.png') }}" alt class="w-px-40 h-auto rounded-circle" />
                            </div>

                          </div>
                          <div class="flex-grow-1">
                            <span class="fw-semibold d-block">John Doe</span>
                            <small class="text-muted">Admin</small>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="{{ path('app_profile') }}">
                          <img src="{{ asset('bo/assets/img/icons/bx-user.svg') }}" alt="Edit" width="20" height="20"/>
                        <span class="align-middle">My Profile</span>
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#">
                          <img src="{{ asset('bo/assets/img/icons/bx-cog.svg') }}" alt="Edit" width="20" height="20"/>
                        <span class="align-middle">Settings</span>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="{{ path('app_login') }}">
                          <img src="{{ asset('bo/assets/img/icons/bx-log-out.svg') }}" alt="Edit" width="20" height="20"/>
                        <span class="align-middle">Log Out</span>
                      </a>
                    </li>
                  </ul>
                </li>
                <!--/ User -->
              </ul>
            </div>
          </nav>


          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->

            <div class="container-xxl flex-grow-1 container-p-y">
              <h4 class="fw-bold py-3 mb-4">Orders report</h4>

           
              

              <!-- Contextual Classes -->

              <div class="card">
                <div class="table-responsive text-nowrap">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Order ID</th>
                        <th>First Address</th>
                        <th>Second Address</th>
                        <th>Delivery Type</th>
                        <th>Order Time</th>
                        <th>Status</th>
                        <th>Created By</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                   <tbody id="all" class="table-border-bottom-0">
    {% for commande in commandes %}
    <tr class="table-default">
        <td><i class="fab fa-sketch fa-lg text-warning me-3"></i> <strong>{{ commande.idCommande }}</strong></td>
        <td>{{ commande.adresseDep }}</td>
        <td>{{ commande.adresseArr }}</td>
        <td><span class="badge bg-label-primary me-1">{{ commande.typeLivraison }}</span></td>
        <td>{{ commande.horaire ? commande.horaire|date('Y-m-d H:i:s') : '' }}</td>
        <td>{{ commande.statut }}</td>
        <td><span class="badge bg-label-primary me-1">{{ commande.createdBy ? commande.createdBy.getNom()}}{{" "}}{{commande.createdBy.getPrenom()}}</span></td>
        <td>
            <!-- Edit Icon -->
            <a href="#" 
               data-bs-toggle="modal"
               data-bs-target="#modalCenter{{ commande.idCommande }}"
               title="Edit">
                <img src="{{ asset('bo/assets/img/icons/edit-regular-24.png') }}" alt="Edit" width="20" height="20" style="filter: invert(34%) sepia(97%) saturate(747%) hue-rotate(185deg) brightness(94%) contrast(85%);" />
            </a>

            
                <!-- Modal for editing the commande -->
                            <div class="modal fade" id="modalCenter{{ commande.idCommande }}" tabindex="-1" aria-labelledby="modalCenterLabel{{ commande.idCommande }}" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="modalCenterLabel{{ commande.idCommande }}">Edit Order #{{ commande.idCommande }}</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <!-- Form for editing the commande -->
                                            {{ form_start(forms[commande.idCommande], {
                                                'attr': {
                                                    'id': 'editForm' ~ commande.idCommande,
                                                    'onsubmit': 'return validateForm(' ~ commande.idCommande ~ ')'
                                                }
                                            })}}
                                            
                                            {{ form_row(forms[commande.idCommande].adresseDep) }}
                                            {{ form_row(forms[commande.idCommande].adresseArr) }}
                                            {{ form_row(forms[commande.idCommande].typeLivraison) }}
                                            {{ form_row(forms[commande.idCommande].horaire) }}
                                            {{ form_row(forms[commande.idCommande].statut) }}
                                            {{form_row(forms[commande.idCommande].createdByDisplay)}}

                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary">Save changes</button>
                                            </div>
                                            
                                            {{ form_end(forms[commande.idCommande]) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
            <!-- End Modal for editing the commande -->

            <!-- Delete Icon -->
            <a href="{{ path('app_commande_delete', {'id_commande': commande.idCommande}) }}" class="text-danger" onclick="return confirm('Are you sure?')">
                <img src="{{ asset('bo/assets/img/icons/trash-regular-24.png') }}" alt="Delete" width="20" height="20" style="filter: invert(26%) sepia(83%) saturate(7471%) hue-rotate(340deg) brightness(95%) contrast(108%);"/>
            </a>
        </td>
    </tr>
    {% else %}
    <tr>
        <td colspan="8" class="text-center">No orders found</td>
    </tr>
    {% endfor %}
</tbody>
                    <tbody id="searchtab" class="table-border-bottom-0">
                        <!-- This tbody will be populated with search results -->
                    </tbody>
                  </table>
                  <div class="text-center">
                    <button class="btn btn-primary" onclick="window.location.href='{{ path('app_admin_commande') }}'">View All</button>
                  </div>
        </table>
    </div>
</div>

{% block javascripts %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
$(document).ready(function() {
    // Store original modals when page loads
    var originalModals = {};
    $('.modal').each(function() {
        var id = $(this).attr('id');
        originalModals[id] = $(this).detach();
    });

    // Search functionality
    $("#searchInput").on('input', function() {
        var value = $(this).val().trim();
        console.log('Searching for:', value);
        
        if (value === '') {
            $('#all').show();
            $('#searchtab').hide().empty();
            // Restore all original modals
            $('body').append($('.modal'));
            return;
        }
        
        $.ajax({
            url: "{{ path('app_admin_commande_search') }}",
            type: 'GET',
            data: { searchValue: value },
            dataType: 'json',
            success: function(response) {
                console.log('Search results:', response);
                
                $('#all').hide();
                var $searchTab = $('#searchtab').empty().show();
                
                // Remove all existing modals first
                $('.modal').remove();
                
                if (response && response.length > 0) {
                    $.each(response, function(i, obj) {
                        var deleteUrl = "/Admincommande/delete/" + obj.idCommande;
                        
                        // Create table row
                        var row = '<tr class="table-default">' +
                            '<td><i class="fab fa-sketch fa-lg text-warning me-3"></i> <strong>' + obj.idCommande + '</strong></td>' +
                            '<td>' + (obj.adresseDep || '') + '</td>' +
                            '<td>' + (obj.adresseArr || '') + '</td>' +
                            '<td><span class="badge bg-label-primary me-1">' + (obj.typeLivraison || '') + '</span></td>' +
                            '<td>' + (obj.horaire || '') + '</td>' +
                            '<td>' + (obj.statut || '') + '</td>' +
                            '<td><span class="badge bg-label-primary me-1">' + 
                                (obj.createdBy ? (obj.createdBy.nom + ' ' + obj.createdBy.prenom) : '') + 
                            '</span></td>' +
                            '<td>' +
                                '<a href="#" class="edit-order-btn" data-id="' + obj.idCommande + '" title="Edit">' +
                                    '<img src="{{ asset('bo/assets/img/icons/edit-regular-24.png') }}" alt="Edit" width="20" height="20" style="filter: invert(34%) sepia(97%) saturate(747%) hue-rotate(185deg) brightness(94%) contrast(85%);" />' +
                                '</a> ' +
                                '<a href="' + deleteUrl + '" class="text-danger" onclick="return confirm(\'Are you sure?\')">' +
                                    '<img src="{{ asset('bo/assets/img/icons/trash-regular-24.png') }}" alt="Delete" width="20" height="20" style="filter: invert(26%) sepia(83%) saturate(7471%) hue-rotate(340deg) brightness(95%) contrast(108%);"/>' +
                                '</a>' +
                            '</td>' +
                        '</tr>';
                        
                        $searchTab.append(row);
                        
                        // Add the corresponding modal if it exists in our original modals
                        var modalId = 'modalCenter' + obj.idCommande;
                        if (originalModals[modalId]) {
                            $('body').append(originalModals[modalId].clone());
                        }
                    });
                } else {
                    $searchTab.append('<tr><td colspan="8" class="text-center">No orders found for "' + value + '"</td></tr>');
                }
                
                // Reinitialize edit buttons
                initEditButtons();
            },
            error: function(xhr, status, error) {
                console.error('Search error:', status, error);
                $('#searchtab').html('<tr><td colspan="8" class="text-center text-danger">Error loading search results</td></tr>');
            }
        });
    });

    // Function to handle edit button clicks
    function initEditButtons() {
        $('.edit-order-btn').off('click').on('click', function(e) {
            e.preventDefault();
            var commandeId = $(this).data('id');
            var modalId = '#modalCenter' + commandeId;
            
            // Check if modal exists
            if ($(modalId).length) {
                $(modalId).modal('show');
            } else {
                alert('Edit form not available for this order');
            }
        });
    }

    // Initialize edit buttons on page load
    initEditButtons();
});
</script>
{% endblock %}
                  </table>
                </div>
              </div>
              <!--/ Contextual Classes -->

              <hr class="my-5" />

              

              

            

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->

   

   <!-- Core JS -->
<!-- build:js assets/vendor/js/core.js -->
<script src="{{ asset('bo/assets/vendor/libs/jquery/jquery.js') }}"></script>
<script src="{{ asset('bo/assets/vendor/libs/popper/popper.js') }}"></script>
<script src="{{ asset('bo/assets/vendor/js/bootstrap.js') }}"></script>
<script src="{{ asset('bo/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js') }}"></script>

<script src="{{ asset('bo/assets/vendor/js/menu.js') }}"></script>
<!-- endbuild -->

<!-- Vendors JS -->
<script src="{{ asset('bo/assets/vendor/libs/masonry/masonry.js') }}"></script>

<!-- Main JS -->
<script src="{{ asset('bo/assets/js/main.js') }}"></script>

    <!-- Page JS -->
    <script src="{{ asset ('bo/assets/js/ui-modals.js')}}"></script>

    <!-- Include Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
function validateForm(commandeId) {
    const form = document.getElementById('editForm' + commandeId);
    const adresseDep = form.querySelector('[name$="[adresseDep]"]').value;
    const adresseArr = form.querySelector('[name$="[adresseArr]"]').value;
    const typeLivraison = form.querySelector('[name$="[typeLivraison]"]').value;
    const horaire = form.querySelector('[name$="[horaire]"]').value;
    const statut = form.querySelector('[name$="[statut]"]').value;

    let isValid = true;
    let errorMessage = '';

    // Address validation - only letters, numbers and spaces
    const addressRegex = /^[a-zA-Z0-9\s]+$/;

    if (!adresseDep.trim()) {
        errorMessage += 'First address is necessary!\n';
        isValid = false;
    } else if (!addressRegex.test(adresseDep)) {
        errorMessage += 'First address can only contain letters, numbers and spaces!\n';
        isValid = false;
    }

    if (!adresseArr.trim()) {
        errorMessage += 'Second address is necessary!\n';
        isValid = false;
    } else if (!addressRegex.test(adresseArr)) {
        errorMessage += 'Second address can only contain letters, numbers and spaces!\n';
        isValid = false;
    }

    // Type Livraison validation
    if (!['standard', 'express'].includes(typeLivraison)) {
        errorMessage += "Delivery type should be 'standard' or 'express'!\n";
        isValid = false;
    }

    // Horaire validation
    if (!horaire) {
        errorMessage += 'Schedule is required!\n';
        isValid = false;
    }

    // Status validation
    if (!['shipping', 'processing', 'delivered'].includes(statut)) {
        errorMessage += "Status should be 'shipping', 'processing' or 'delivered'!\n";
        isValid = false;
    }

    if (!isValid) {
        alert(errorMessage);
    }

    return isValid;
}
</script>

    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
  </body>
</html>